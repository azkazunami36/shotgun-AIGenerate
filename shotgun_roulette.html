<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ショットガン・ルーレット ver.α0.16</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- 固定ヘルプ（左端 ? ボタン） -->
  <button id="helpToggle" class="help-fab" aria-label="アイテム説明">?</button>
  <aside id="helpPanel" class="help-panel" aria-hidden="true">
    <div class="help-head">
      <div>アイテム説明</div>
      <button id="helpClose" class="btn small">閉じる</button>
    </div>
    <ul class="help-list">
      <li><b>ノコギリ</b>：次の命中ダメージが <b>2倍</b> になる（一回限り）。</li>
      <li><b>拡大鏡</b>：次に撃たれる弾（先頭弾）が <b>実弾/空包</b> か確認できる。</li>
      <li><b>ビール</b>：次の弾を <b>排莢</b> して捨てる（薬室から1発除去）。</li>
      <li><b>タバコ</b>：自分の <b>HP+1</b>。</li>
      <li><b>手錠</b>：次のプレイヤーのターンを <b>スキップ</b>。</li>
    </ul>
  </aside>

  <!-- SPAナビゲーション -->
  <header class="topbar">
    <nav class="nav">
      <a href="#/game" id="navGame" class="nav-link">ゲーム</a>
      <a href="#/settings" id="navSettings" class="nav-link">ゲーム設定</a>
      <span class="ver">ver.α0.16</span>
    </nav>
  </header>

  <!-- タイトル画面 -->
  <div id="titleScreen" class="title-screen">
    <h1>ショットガン・ルーレット</h1>
    <p>digital edition — assets + localStorage + volume</p>
    <button id="startBtnTitle" class="btn primary big">START</button>
    <div class="small">※最初のクリックでサウンドを有効化</div>
  </div>

  <!-- 視認フラッシュ -->
  <div id="flashOverlay"></div>

  <!-- ビュー: ゲーム本体 -->
  <main id="view-game" class="view hidden">
    <div class="toolbar">
      <button id="openSettings" class="btn">⚙️ UI設定</button>
      <button id="muteToggle" class="btn">🔇 ミュート</button>
      <div class="volrow">
        <span>Master</span>
        <input id="volMasterToolbar" type="range" min="0" max="1" step="0.01">
        <span id="volMasterToolbarLabel" class="small">100%</span>
      </div>
    </div>

    <section class="controls">
      <div class="panel">
        <label>プレイヤー数</label>
        <select id="playerCount">
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4" selected>4</option>
        </select>

        <label>初期HP（各プレイヤー）</label>
        <input type="number" id="initHp" value="5" min="1" max="20" />

        <label>薬室（合計発数）</label>
        <input type="number" id="chamberSize" value="6" min="1" max="12" />

        <label>実弾数（薬室内）</label>
        <input type="number" id="liveCount" value="3" min="0" max="12" />

        <div class="mt8">
          <button id="startBtn" class="btn primary">ゲーム開始</button>
          <button id="resetBtn" class="btn danger">リセット</button>
        </div>
        <div class="mt8 small muted">
          ※ アイテム：ノコギリ / 拡大鏡 / ビール / タバコ / 手錠
        </div>
      </div>

      <div class="panel">
        <div class="big">現在ラウンド: <span id="roundNo">0</span></div>
        <div class="chamber">残薬室: <span id="chamberRemain">0</span> / <span id="chamberTotal">0</span></div>
        <div>先頭弾の状態: <span id="peekState">不明</span></div>
        <div class="mt8">現在ターン: <span id="currentPlayer">-</span></div>
        <div class="mt8 actions">
          <select id="targetSelect" class="target-select"></select>
          <button id="shootBtn" class="btn">撃つ</button>
          <button id="shootSelfBtn" class="btn">自分に撃つ</button>
        </div>
        <div class="mt8">
          <button id="endTurnBtn" class="btn">ターン終了</button>
        </div>
      </div>

      <div class="panel flex1 minw260">
        <div class="bold mb8">プレイヤー一覧</div>
        <div id="playersContainer" class="players"></div>
      </div>
    </section>

    <section class="game">
      <div class="panel flex1">
        <div class="bold mb8">行動ログ</div>
        <div id="log" class="log"></div>
        <div class="mt8"><button id="clearLog" class="btn">ログクリア</button></div>
      </div>

      <div class="panel w340">
        <div class="bold mb8">アイテム操作</div>
        <div id="itemControls">
          <div>自分のアイテムをクリックして使用してください（ターン中のみ）。</div>
          <div class="mt8" id="yourItems"></div>
        </div>

        <div class="mt12">
          <div class="bold mb6">拡大鏡で覗いた情報</div>
          <div id="peekArea" class="peek-indicator">なし</div>
        </div>
      </div>

      <!-- キャラクター表情 -->
      <div class="panel w380">
        <div class="bold mb8">キャラクター表情</div>
        <div class="portrait-wrap">
          <div id="portraitFrame" class="portrait-frame">
            <div id="portraitImg" class="portrait-img"></div>
            <div id="portraitBadge" class="portrait-badge">通常</div>
          </div>
        </div>
        <div class="row mt8">
          <input id="portraitUrl" type="url" placeholder="表情画像URL / data URL…">
          <button id="portraitApply" class="btn small">適用</button>
        </div>
        <div class="row mt8 expr-row">
          <button class="btn small" data-expr="通常">通常</button>
          <button class="btn small" data-expr="微笑">微笑</button>
          <button class="btn small" data-expr="驚き">驚き</button>
          <button class="btn small" data-expr="怒り">怒り</button>
          <button class="btn small" data-expr="しょんぼり">しょんぼり</button>
        </div>
      </div>
    </section>

    <footer class="footer">バージョン: α0.16 — 内部ロジックとGUI分離（GameEngine / UIController）</footer>
  </main>

  <!-- ビュー: ゲーム設定 -->
  <main id="view-settings" class="view hidden">
    <h2>ゲーム設定</h2>
    <div class="panel w560">
      <div class="row">
        <label class="chk">
          <input id="optHideChamberRemain" type="checkbox">
          残薬室を非表示にする
        </label>
      </div>
      <div class="row small muted">
        非表示にすると、ゲーム画面の「残薬室」は「??」と表示されます。
      </div>
      <div class="mt12">
        <button id="saveGameOpts" class="btn primary">保存</button>
        <span id="saveGameOptsResult" class="small" aria-live="polite"></span>
      </div>
    </div>
    <div class="mt12">
      <a class="btn" href="#/game">← ゲームへ戻る</a>
    </div>
  </main>

  <!-- 設定モーダル -->
  <div id="settingsModal" class="modal hidden">
    <div id="settingsBackdrop" class="backdrop"></div>
    <div id="settingsPanel" class="panel modal-panel">
      <div class="modal-head">
        <h2>UI画像・テーマ設定（assets → localStorage 上書き）</h2>
        <button id="closeSettings" class="btn small">閉じる</button>
      </div>

      <div class="grid">
        <div class="panel">
          <h3>サウンド設定</h3>
          <div class="row small muted">URL または data URL を入力すると適用されます。</div>
          <div class="row"><label>空包</label><input id="sndBlankUrl" type="url" placeholder="空包音URL"></div>
          <div class="row"><label>実弾</label><input id="sndLiveUrl" type="url" placeholder="実弾音URL"></div>
          <div class="row"><label>クリック</label><input id="sndClickUrl" type="url" placeholder="クリック音URL"></div>
          <div class="row volrow"><span>Master</span><input id="volMaster" type="range" min="0" max="1" step="0.01"><span id="volMasterLabel" class="small">100%</span></div>
          <div class="row volrow"><span>空包</span><input id="volBlank" type="range" min="0" max="1" step="0.01"><span id="volBlankLabel" class="small">100%</span></div>
          <div class="row volrow"><span>実弾</span><input id="volLive" type="range" min="0" max="1" step="0.01"><span id="volLiveLabel" class="small">100%</span></div>
          <div class="row volrow"><span>クリック</span><input id="volClick" type="range" min="0" max="1" step="0.01"><span id="volClickLabel" class="small">100%</span></div>
          <div class="row"><button id="soundsApply" class="btn">サウンド適用</button> <button id="testBlank" class="btn small">空包テスト</button> <button id="testLive" class="btn small">実弾テスト</button> <button id="testClick" class="btn small">クリックテスト</button></div>
        </div>

        <div class="panel">
          <h3>背景画像</h3>
          <div class="row"><input id="bgUrl" type="url" placeholder="画像URL / data URL…"><button id="bgApply" class="btn small">適用</button></div>
          <div class="preview" id="bgPreview"></div>
        </div>

        <div class="panel">
          <h3>パネル背景</h3>
          <div class="row"><input id="panelUrl" type="url" placeholder="画像URL / data URL…"><button id="panelApply" class="btn small">適用</button></div>
          <div class="preview" id="panelPreview"></div>
        </div>

        <div class="panel">
          <h3>フラッシュ色</h3>
          <div class="row"><input id="flashColor" type="color" value="#ffffff"><button id="flashTest" class="btn small">テスト</button></div>
        </div>

        <div class="panel">
          <h3>プレイヤーアバター</h3>
          <div class="row small muted">localStorage が assets より常に優先</div>
          <div class="row"><span class="icon-preview" id="p1Prev"></span><input id="p1Url" type="url" placeholder="P1画像…"></div>
          <div class="row"><span class="icon-preview" id="p2Prev"></span><input id="p2Url" type="url" placeholder="P2画像…"></div>
          <div class="row"><span class="icon-preview" id="p3Prev"></span><input id="p3Url" type="url" placeholder="P3画像…"></div>
          <div class="row"><span class="icon-preview" id="p4Prev"></span><input id="p4Url" type="url" placeholder="P4画像…"></div>
          <div class="row"><button id="avatarsApply" class="btn small">アバター適用</button></div>
        </div>

        <div class="panel">
          <h3>アイテムアイコン</h3>
          <div class="row"><span class="icon-preview" id="icoSawPrev"></span><input id="icoSaw" type="url" placeholder="ノコギリ…"></div>
          <div class="row"><span class="icon-preview" id="icoGlassPrev"></span><input id="icoGlass" type="url" placeholder="拡大鏡…"></div>
          <div class="row"><span class="icon-preview" id="icoBeerPrev"></span><input id="icoBeer" type="url" placeholder="ビール…"></div>
          <div class="row"><span class="icon-preview" id="icoSmokePrev"></span><input id="icoSmoke" type="url" placeholder="タバコ…"></div>
          <div class="row"><span class="icon-preview" id="icoCuffPrev"></span><input id="icoCuff" type="url" placeholder="手錠…"></div>
          <div class="row"><button id="iconsApply" class="btn small">アイコン適用</button></div>
        </div>
      </div>

      <div class="mt12 modal-foot">
        <div class="small muted">保存先キー: <b>sg_roulette_theme_v016</b></div>
        <div class="row">
          <button id="saveTheme" class="btn">保存</button>
          <button id="exportTheme" class="btn">エクスポート</button>
          <input id="importThemeFile" type="file" accept="application/json" style="display:none;">
          <button id="importTheme" class="btn">インポート</button>
          <button id="resetTheme" class="btn danger">リセット</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Audio elements -->
  <audio id="sndBlank" preload="auto"></audio>
  <audio id="sndLive" preload="auto"></audio>
  <audio id="sndClick" preload="auto"></audio>

  <script src="script.js"></script>
</body>
</html>
